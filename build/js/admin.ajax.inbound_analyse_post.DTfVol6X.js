var m=(n,i,a)=>new Promise((d,p)=>{var _=t=>{try{e(a.next(t))}catch(s){p(s)}},r=t=>{try{e(a.throw(t))}catch(s){p(s)}},e=t=>t.done?d(t.value):Promise.resolve(t.value).then(_,r);e((a=a.apply(n,i)).next())});import{c as v}from"./admin.check_lrseo_page.Ci4yMWoH.js";import{S as y}from"./admin.cache.CizTyhoi.js";jQuery(document).ready(function(n){if(!v())return;const i=n("#inbound_submit_posts_link"),a=n("#inbound_progress_bar_posts_link"),d=n("#inbound_progress_bar_posts_link_text");i.on("click",function(_){_.preventDefault();const r=n('input[name="post[]"]:checked'),e=[];if(r.each(function(){e.push(n(this).data("id"))}),e.length===0)return;const t=n("#inbound_kw_post").val();if(!t){alert("Veuillez renseigner un mot-clé");return}const s=a.find(".bar");a.removeClass("lr-hidden"),s.attr("style","width: 0%;"),d.text(`0/${e.length}`),i.attr("disabled",!0),i.text("Analyse des articles en cours...");const l=[],o=[];for(let c=0;c<e.length;c++){const b=e[c],g={action:"lrseo_inbound_analyse_post",post_id_dst:e[c],post_id_src:n("#inbound_src_post").val(),kw:t,security:lrseo_inbound_analyse_post.nonce};if(y.get(`lrseo_inbound_analyse_post_${b}`)){o.push(y.get(`lrseo_inbound_analyse_post_${b}`)),d.text(`${o.length}/${e.length}`),s.attr("style",`width: ${Math.round(o.length/e.length*100)}%;`);continue}l.push(new Promise(f=>m(this,null,function*(){yield new Promise(u=>setTimeout(u,c*300)),n.post(lrseo_inbound_analyse_post.url,g,u=>{u.success?(o.push(u.data),d.text(`${o.length}/${e.length}`),s.attr("style",`width: ${Math.round(o.length/e.length*100)}%;`),f()):(console.error(u.data),n.post(lrseo_inbound_analyse_post.url,g,h=>{h.success?(o.push(h.data),d.text(`${o.length}/${e.length}`),s.attr("style",`width: ${Math.round(o.length/e.length*100)}%;`),f()):console.error(h.data)}))})})))}Promise.all(l).then(()=>{a.addClass("lr-hidden"),p(o)})});function p(_){console.log("displayResults",_),a.addClass("lr-hidden"),i.attr("disabled",!1),i.text("Suggérer des liens"),d.text("");const r=n("#inbound_posts_link_results");if(r.empty(),_.length===0){r.append("<p>Aucun résultat</p>");return}_.forEach((e,t)=>{r.append(`<h3 className="title">${e[t].title_dst}</h3>`),e.forEach((s,l)=>{r.append(`
                <div class="lr-flex lr-flex-col lr-gap-2 lr-mb-2">
                    <div class="lr-flex lr-gap-2">
                        <div class="lr-self-center lr-w-1/6">Texte avant: </div>
<!--                        <input class="lr-grow" type="text" id="inbound_text_before_${t}_${l}" value=""/>-->
                        <div id="inbound_html_before_${t}_${l}"></div>
                    </div>
                    <div class="lr-flex lr-gap-2">
                        <div class="lr-self-center lr-w-1/6">Phrase du lien: </div>
<!--                        <input class="lr-grow" type="text" id="inbound_text_sentence_${t}_${l}" value=""/>-->
                        <div id="inbound_html_sentence_${t}_${l}"></div>
                    </div>
                    <button type="button" id="inbound_edit_article_${t}_${l}" class="button button-secondary">Aller sur la modification de l'article</button>
                </div>
                <hr/>
            `),n("#inbound_html_before_"+t+"_"+l).html(s.before),n("#inbound_html_sentence_"+t+"_"+l).html(s.sentence),n("#inbound_edit_article_"+t+"_"+l).on("click",function(){window.open("/wp-admin/post.php?post="+s.id_dst+"&action=edit","_blank")})})})}});
