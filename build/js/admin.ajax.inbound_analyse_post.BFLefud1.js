var y=(n,a,l)=>new Promise((i,_)=>{var r=e=>{try{t(l.next(e))}catch(o){_(o)}},d=e=>{try{t(l.throw(e))}catch(o){_(o)}},t=e=>e.done?i(e.value):Promise.resolve(e.value).then(r,d);t((l=l.apply(n,a)).next())});import{c as v}from"./admin.check_lrseo_page.Ci4yMWoH.js";import{S as m}from"./admin.cache.4-osdmxG.js";jQuery(document).ready(function(n){if(!v())return;const a=n("#inbound_submit_posts_link"),l=n("#inbound_progress_bar_posts_link"),i=n("#inbound_progress_bar_posts_link_text");a.on("click",function(r){r.preventDefault();const d=n('input[name="post[]"]:checked'),t=[];if(d.each(function(){t.push(n(this).data("id"))}),t.length===0)return;const e=n("#inbound_kw_post").val();if(!e){alert("Veuillez renseigner un mot-clé");return}const o=l.find(".bar");l.removeClass("lr-hidden"),o.attr("style","width: 0%;"),i.text(`0/${t.length}`),a.attr("disabled",!0),a.text("Analyse des articles en cours...");const h=[],s=[];for(let c=0;c<t.length;c++){const b=t[c],g={action:"lrseo_inbound_analyse_post",post_id_dst:t[c],post_id_src:n("#inbound_src_post").val(),kw:e,security:lrseo_inbound_analyse_post.nonce};if(m.get(`lrseo_inbound_analyse_post_${b}`)){s.push(m.get(`lrseo_inbound_analyse_post_${b}`)),i.text(`${s.length}/${t.length}`),o.attr("style",`width: ${Math.round(s.length/t.length*100)}%;`);continue}h.push(new Promise(f=>y(this,null,function*(){yield new Promise(u=>setTimeout(u,c*300)),n.post(lrseo_inbound_analyse_post.url,g,u=>{u.success?(s.push(u.data),i.text(`${s.length}/${t.length}`),o.attr("style",`width: ${Math.round(s.length/t.length*100)}%;`),f()):(console.error(u.data),n.post(lrseo_inbound_analyse_post.url,g,p=>{p.success?(s.push(p.data),i.text(`${s.length}/${t.length}`),o.attr("style",`width: ${Math.round(s.length/t.length*100)}%;`),f()):console.error(p.data)}))})})))}Promise.all(h).then(()=>{l.addClass("lr-hidden"),_(s)})});function _(r){console.log("displayResults",r),l.addClass("lr-hidden"),a.attr("disabled",!1),a.text("Suggérer des liens"),i.text("");const d=n("#inbound_posts_link_results");if(d.empty(),r.length===0){d.append("<p>Aucun résultat</p>");return}r.forEach((t,e)=>{d.append(`
                <h3 class="title">${t.title_dst}</h3>
                <div class="lr-flex lr-flex-col lr-gap-2 lr-mb-2">
                    <div class="lr-flex lr-gap-2">
                        <div class="lr-self-center lr-w-1/6">Texte avant: </div>
                        <input class="lr-grow" type="text" id="inbound_text_before_${e}" value=""/>
                    </div>
                    <div class="lr-flex lr-gap-2">
                        <div class="lr-self-center lr-w-1/6">Phrase: </div>
                        <input class="lr-grow" type="text" id="inbound_text_sentence_${e}" value=""/>
                    </div>
                    <button type="button" id="inbound_edit_article_${e}" class="button button-secondary">Aller sur la modification de l'article</button>
                </div>
                <hr/>
            `),n("#inbound_text_before_"+e).val(t.before),n("#inbound_text_sentence_"+e).val(t.sentence),n("#inbound_edit_article_"+e).on("click",function(){window.open("/wp-admin/post.php?post="+t.id_dst+"&action=edit","_blank")})})}});
