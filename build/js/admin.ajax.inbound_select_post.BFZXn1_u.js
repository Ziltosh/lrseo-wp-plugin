var w=(s,n,i)=>new Promise((l,c)=>{var o=e=>{try{t(i.next(e))}catch(a){c(a)}},r=e=>{try{t(i.throw(e))}catch(a){c(a)}},t=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,r);t((i=i.apply(s,n)).next())});import{S as y}from"./admin.cache.CizTyhoi.js";import{c as x}from"./admin.check_lrseo_page.Ci4yMWoH.js";jQuery(document).ready(function(s){if(!x())return;const n=s("#inbound_select_post");n.on("click",function(l){l.preventDefault();let o=new URLSearchParams(window.location.search).get("lrseo_inbound_post_select");const r=s("#inbound_kw_post").val(),t=s('tr[data-id="'+o+'"]').data("title"),e=[];if(!r){alert("Veuillez renseigner un mot-cl√©");return}n.attr("disabled",!0),n.text("Analyse des articles en cours...");const a=y.get(`lrseo_inbound_select_post_${o}_${r}`);if(a){e.push(...a),i(e,o);return}const m=s("#inbound_progress_bar"),p=s("#inbound_progress_bar_text"),h=m.find(".bar");m.removeClass("lr-hidden"),h.attr("style","width: 0%;");const d=s("#lrseo_allposts_tbody tr").length-1,b=50,f=[];p.text(`0/${d}`);for(let u=0;u<d;u+=b){const g={action:"lrseo_inbound_select_post",kw:r,title:t,post_id:o,current:u,step:b,security:lrseo_inbound_select_post.nonce};f.push(new Promise(v=>w(this,null,function*(){yield new Promise(_=>setTimeout(_,u*50)),s.post(lrseo_inbound_select_post.url,g,_=>{_.success&&(e.push(..._.data),p.text(`${e.length}/${d}`),h.attr("style",`width: ${Math.round(e.length/d*100)}%;`)),v()})})))}Promise.all(f).then(()=>{m.addClass("lr-hidden"),y.store(e,`lrseo_inbound_select_post_${o}_${r}`,60),i(e,o)})});function i(l,c){l.sort((r,t)=>t.score-r.score),s("#inbound_table_results").removeClass("lr-hidden"),s("#inbound_results").removeClass("lr-hidden"),s("#inbound_src_post").val(c),n.attr("disabled",!1),n.text("Voir les articles sources potentiels");const o=s("#inbound_tbody_results");if(o.html(""),l){const r=l.map(t=>`<tr>
                    <th scope="row" class="check-column"><input type="checkbox" name="post[]" ${t.score>=85&&"checked"} data-id="${t.id}" data-title="${t.title}"/></th>
                    <td class="title has-row-actions column-title column-primary lr-max-w-[800px] lr-overflow-y-scroll">
                        <strong>${t.titre||t.title||""}</strong>
                        <div class="row-actions">
                            <span class="edit"><a href="/wp-admin/post.php?post=${t.id}&action=edit">Modifier</a> | </span>
                            <span class="view"><a href="/?p=${t.id}" target="_blank">Voir</a></span>
                        </div>
                    </td>
                    <td>${t.score}</td>
                    <td>${Intl.NumberFormat("fr-FR",{maximumFractionDigits:2}).format(t.pct_links/100)}</td>
                </tr>`).join("");o.html(r)}}});
