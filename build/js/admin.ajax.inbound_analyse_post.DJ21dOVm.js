var y=(o,d,l)=>new Promise((c,f)=>{var _=n=>{try{t(l.next(n))}catch(r){f(r)}},u=n=>{try{t(l.throw(n))}catch(r){f(r)}},t=n=>n.done?c(n.value):Promise.resolve(n.value).then(_,u);t((l=l.apply(o,d)).next())});import{c as w}from"./admin.check_lrseo_page.Ci4yMWoH.js";import{S as v}from"./admin.cache.CizTyhoi.js";jQuery(document).ready(function(o){if(!w())return;const d=o("#inbound_submit_posts_link"),l=o("#inbound_progress_bar_posts_link"),c=o("#inbound_progress_bar_posts_link_text");d.on("click",function(_){_.preventDefault();const u=o('input[name="post[]"]:checked'),t=[];if(u.each(function(){t.push(o(this).data("id"))}),t.length===0)return;const n=o("#inbound_kw_post").val();if(!n){alert("Veuillez renseigner un mot-clÃ©");return}const r=l.find(".bar");l.removeClass("lr-hidden"),r.attr("style","width: 0%;"),c.text(`0/${t.length}`),d.attr("disabled",!0),d.text("Analyse des articles en cours...");const s=[],e=[];for(let i=0;i<t.length;i++){const h=t[i],a={action:"lrseo_inbound_analyse_post",post_id_dst:t[i],post_id_src:o("#inbound_src_post").val(),kw:n,security:lrseo_inbound_analyse_post.nonce};if(v.get(`lrseo_inbound_analyse_post_${h}`)){e.push(v.get(`lrseo_inbound_analyse_post_${h}`)),c.text(`${e.length}/${t.length}`),r.attr("style",`width: ${Math.round(e.length/t.length*100)}%;`);continue}s.push(new Promise(g=>y(this,null,function*(){yield new Promise(p=>setTimeout(p,i*300)),o.post(lrseo_inbound_analyse_post.url,a,p=>{p.success?(e.push(p.data),c.text(`${e.length}/${t.length}`),r.attr("style",`width: ${Math.round(e.length/t.length*100)}%;`),g()):(console.error(p.data),o.post(lrseo_inbound_analyse_post.url,a,b=>{b.success?(e.push(b.data),c.text(`${e.length}/${t.length}`),r.attr("style",`width: ${Math.round(e.length/t.length*100)}%;`),g()):console.error(b.data)}))})})))}Promise.all(s).then(()=>{l.addClass("lr-hidden"),f(e)})});function f(_){console.log("displayResults",_),l.addClass("lr-hidden"),d.attr("disabled",!1),d.text("SuggÃ©rer des liens"),c.text("");const u=o("#inbound_posts_link_results");if(u.empty(),_.length===0){u.append("<p>Aucun rÃ©sultat</p>");return}let t="";_.forEach((n,r)=>{t+=`<div class="lr-p-6 lr-border-1 lr-mb-2 lr-border-dashed lr-border-gray-400 lr-bg-white">
                <h3 class="title">Article source: ${n[0].title_dst}</h3>`,n.forEach((s,e)=>{const i=new TextEncoder().encode(s.before),h=Array.from(i,m=>String.fromCodePoint(m)).join(""),a=btoa(h),g=new TextEncoder().encode(s.sentence),p=Array.from(g,m=>String.fromCodePoint(m)).join(""),b=btoa(p);t+=`<div class="lr-flex lr-flex-col lr-gap-2 lr-mb-2">
                    <div class="lr-flex lr-gap-2">
                        <div class="lr-self-center lr-w-1/6">Texte avant: </div>
                        <div class="lrse_copy_clipboard lr-cursor-pointer lr-underline" data-html="${a}">ðŸ“‹</div>
                        <div id="inbound_html_before_${r}_${e}">${s.before}</div>
                    </div>
                    <div class="lr-flex lr-gap-2">
                        <div class="lr-self-center lr-w-1/6">Phrase du lien: </div>
                        <div class="lrse_copy_clipboard lr-cursor-pointer lr-underline" data-html="${b}">ðŸ“‹</div>
                        <div id="inbound_html_sentence_${r}_${e}">${s.sentence}</div>
                    </div>
                    <a type="button" href="/wp-admin/post.php?post=${s.id_dst}&action=edit" target="_blank" id="inbound_edit_article_${r}_${e}" class="lr-max-w-[300px] button button-secondary">Aller sur la modification de l'article</a>
                </div>
                <hr />`}),t+="</div>"}),u.append(t),o(".lrse_copy_clipboard").on("click",function(){const n=atob(o(this).data("html")),r=Uint8Array.from(n,a=>a.codePointAt(0)),s=new TextDecoder().decode(r),e="text/html",i=new Blob([s],{type:e}),h=[new ClipboardItem({[e]:i})];navigator.clipboard.write(h).then(function(){console.log("Copied to clipboard")}).catch(function(a){console.error("Copy failed",a)})})}});
