import{c as w}from"./admin.check_lrseo_page.Ci4yMWoH.js";import{S as v}from"./admin.cache.CizTyhoi.js";jQuery(document).ready(function(n){if(!w())return;const d=n("#inbound_submit_posts_link"),b=n("#inbound_progress_bar_posts_link"),c=n("#inbound_progress_bar_posts_link_text");d.on("click",function(h){h.preventDefault();const u=n('input[name="post[]"]:checked'),t=[];if(u.each(function(){t.push(n(this).data("id"))}),t.length===0)return;const a=n("#inbound_kw_post").val();if(!a){alert("Veuillez renseigner un mot-clé");return}const o=b.find(".bar");b.removeClass("lr-hidden"),o.attr("style","width: 0%;"),c.text(`0/${t.length}`),d.attr("disabled",!0),d.text("Analyse des articles en cours...");const r=[],e=[];for(let s=0;s<t.length;s++){const i=t[s],l={action:"lrseo_inbound_analyse_post",post_id_dst:t[s],post_id_src:n("#inbound_src_post").val(),kw:a,security:lrseo_inbound_analyse_post.nonce};if(v.get(`lrseo_inbound_analyse_post_${i}`)){e.push(v.get(`lrseo_inbound_analyse_post_${i}`)),c.text(`${e.length}/${t.length}`),o.attr("style",`width: ${Math.round(e.length/t.length*100)}%;`);continue}r.push(new Promise(g=>{setTimeout(()=>{n.post(lrseo_inbound_analyse_post.url,l,p=>{p.success?(e.push(p.data),c.text(`${e.length}/${t.length}`),o.attr("style",`width: ${Math.round(e.length/t.length*100)}%;`)):(console.error(p.data),n.post(lrseo_inbound_analyse_post.url,l,_=>{_.success?(e.push(_.data),c.text(`${e.length}/${t.length}`),o.attr("style",`width: ${Math.round(e.length/t.length*100)}%;`)):console.error(_.data)})),g()})},s*1e4)}))}Promise.all(r).then(()=>{b.addClass("lr-hidden"),m(e)})});function m(h){console.log("displayResults",h),b.addClass("lr-hidden"),d.attr("disabled",!1),d.text("Suggérer des liens"),c.text("");const u=n("#inbound_posts_link_results");if(u.empty(),h.length===0){u.append("<p>Aucun résultat</p>");return}let t="";h.forEach((a,o)=>{t+=`<div class="lr-p-6 lr-border-1 lr-mb-2 lr-border-dashed lr-border-gray-400 lr-bg-white">
                <h3 class="title">Article source: ${a[0].title_dst}</h3>`,a.forEach((r,e)=>{const s=new TextEncoder().encode(r.before),i=Array.from(s,f=>String.fromCodePoint(f)).join(""),l=btoa(i),g=new TextEncoder().encode(r.sentence),p=Array.from(g,f=>String.fromCodePoint(f)).join(""),_=btoa(p);t+=`<div class="lr-flex lr-flex-col lr-gap-2 lr-mb-2">
                    <div class="lr-flex lr-gap-2">
                        <div class="lr-self-center lr-w-1/6">Texte avant: </div>
                        <div class="lrse_copy_clipboard lr-cursor-pointer lr-underline" data-html="${l}"><svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
  <path stroke="currentColor" stroke-linejoin="round" stroke-width="2" d="M9 8v3a1 1 0 0 1-1 1H5m11 4h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-7a1 1 0 0 0-1 1v1m4 3v10a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1v-7.13a1 1 0 0 1 .24-.65L7.7 8.35A1 1 0 0 1 8.46 8H13a1 1 0 0 1 1 1Z"/>
</svg>
</div>
                        <div id="inbound_html_before_${o}_${e}">${r.before}</div>
                    </div>
                    <div class="lr-flex lr-gap-2">
                        <div class="lr-self-center lr-w-1/6">Phrase du lien: </div>
                        <div class="lrse_copy_clipboard lr-cursor-pointer lr-underline" data-html="${_}"><svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
  <path stroke="currentColor" stroke-linejoin="round" stroke-width="2" d="M9 8v3a1 1 0 0 1-1 1H5m11 4h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-7a1 1 0 0 0-1 1v1m4 3v10a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1v-7.13a1 1 0 0 1 .24-.65L7.7 8.35A1 1 0 0 1 8.46 8H13a1 1 0 0 1 1 1Z"/>
</svg>
</div>
                        <div id="inbound_html_sentence_${o}_${e}">${r.sentence}</div>
                    </div>
                    <a type="button" href="/wp-admin/post.php?post=${r.id_dst}&action=edit" target="_blank" id="inbound_edit_article_${o}_${e}" class="lr-max-w-[300px] button button-secondary">Aller sur la modification de l'article</a>
                </div>
                <hr />`}),t+="</div>"}),u.append(t),n(".lrse_copy_clipboard").on("click",function(){const a=atob(n(this).data("html")),o=Uint8Array.from(a,l=>l.codePointAt(0)),r=new TextDecoder().decode(o),e="text/html",s=new Blob([r],{type:e}),i=[new ClipboardItem({[e]:s})];navigator.clipboard.write(i).then(function(){console.log("Copied to clipboard")}).catch(function(l){console.error("Copy failed",l)})})}});
